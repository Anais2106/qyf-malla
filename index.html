<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Malla Curricular Química y Farmacia UCM</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap');
  body {
    font-family: 'Montserrat', sans-serif;
    background: #fff0f6;
    margin: 0; padding: 1rem;
    color: #5a2a42;
  }
  h1 {
    text-align: center;
    margin-bottom: 1rem;
    color: #b83e6e;
  }
  .malla {
    display: flex;
    overflow-x: auto;
    gap: 0.8rem;
    padding-bottom: 1rem;
  }
  .semestre {
    min-width: 220px;
    background: #ffe3ec;
    border-radius: 8px;
    padding: 0.5rem;
    box-shadow: 0 0 8px #f6c1d8aa;
    flex-shrink: 0;
  }
  .semestre h2 {
    text-align: center;
    font-weight: 600;
    margin-bottom: 0.7rem;
    color: #b03a5d;
    border-bottom: 2px solid #b83e6e;
    padding-bottom: 0.3rem;
  }
  .materia {
    background: #fcd8e7;
    margin: 0.25rem 0;
    padding: 0.5rem 0.7rem;
    border-radius: 6px;
    cursor: pointer;
    position: relative;
    transition: background-color 0.3s ease;
    user-select: none;
  }
  .materia.aprobada {
    background: #a73e5c;
    color: white;
    font-weight: 600;
  }
  .materia.bloqueada {
    background: #f9b6cb;
    color: #6b2e42;
    cursor: not-allowed;
    font-style: italic;
  }
  /* Tooltip styling */
  .materia.bloqueada:hover::after {
    content: attr(data-tooltip);
    position: absolute;
    left: 105%;
    top: 50%;
    transform: translateY(-50%);
    background: #b83e6e;
    color: white;
    padding: 6px 10px;
    border-radius: 6px;
    white-space: pre-line;
    z-index: 10;
    width: 160px;
    box-shadow: 0 0 6px #b83e6eaa;
    font-size: 0.85rem;
  }
</style>
</head>
<body>

<h1>Malla Curricular Química y Farmacia (UCM)</h1>

<div class="malla" id="malla">
  <!-- Columnas semestre se generan con JS -->
</div>

<script>
(() => {
  // Datos materias con prerrequisitos
  // Cada materia tiene id único y array con ids de requisitos
  // Para tooltip mostramos nombres de requisitos que faltan

  const materiasData = {
    // Semestre 1
    "quimica-general-i": { nombre: "Química General I", prereq: [] },
    "biologia-celular-y-molecular": { nombre: "Biología Celular y Molecular", prereq: [] },
    "morfologia-humana-i": { nombre: "Morfología Humana I", prereq: [] },
    "matematica-i": { nombre: "Matemática I", prereq: [] },
    "introduccion-a-la-farmacia-y-las-ciencias-i": { nombre: "Introducción a la Farmacia y las Ciencias I", prereq: [] },
    "aprendizaje-eficiente": { nombre: "Aprendizaje Eficiente", prereq: [] },

    // Semestre 2
    "quimica-general-ii": { nombre: "Química General II", prereq: ["quimica-general-i"] },
    "bioquimica-general-y-molecular": { nombre: "Bioquímica General y Molecular", prereq: ["biologia-celular-y-molecular"] },
    "morfologia-humana-ii": { nombre: "Morfología Humana II", prereq: ["morfologia-humana-i"] },
    "matematica-ii": { nombre: "Matemática II", prereq: ["matematica-i"] },
    "fisica": { nombre: "Física", prereq: ["matematica-i"] },
    "introduccion-a-la-farmacia-y-las-ciencias-ii": { nombre: "Introducción a la Farmacia y las Ciencias II", prereq: ["introduccion-a-la-farmacia-y-las-ciencias-i"] },
    "ingles-i": { nombre: "Inglés I", prereq: [] },

    // Semestre 3
    "quimica-analitica": { nombre: "Química Analítica", prereq: ["quimica-general-ii"] },
    "quimica-organica-i": { nombre: "Química Orgánica I", prereq: ["quimica-general-ii"] },
    "fisiologia-i": { nombre: "Fisiología I", prereq: ["bioquimica-general-y-molecular"] },
    "bioestadisticas": { nombre: "Bioestadísticas", prereq: ["matematica-ii"] },
    "fisicoquimica": { nombre: "Fisicoquímica", prereq: ["quimica-general-ii", "fisica"] },
    "taller-de-iniciacion-farmaceutica": { nombre: "Taller de Iniciación Farmacéutica", prereq: ["introduccion-a-la-farmacia-y-las-ciencias-ii"] },
    "ingles-ii": { nombre: "Inglés II", prereq: ["ingles-i"] },

    // Semestre 4
    "analisis-instrumental": { nombre: "Análisis Instrumental", prereq: ["fisicoquimica", "quimica-analitica"] },
    "quimica-organica-ii": { nombre: "Química Orgánica II", prereq: ["quimica-organica-i"] },
    "fisiologia-ii": { nombre: "Fisiología II", prereq: ["fisiologia-i"] },
    "elementos-inmunes": { nombre: "Elementos Inmunes", prereq: ["bioquimica-general-y-molecular"] },
    "genetica-y-genomica": { nombre: "Genética y Genómica", prereq: ["bioquimica-general-y-molecular"] },
    "taller-de-formacion-farmaceutica": { nombre: "Taller de Formación Farmacéutica", prereq: [
      "quimica-general-i", "biologia-celular-y-molecular", "morfologia-humana-i", "matematica-i", "introduccion-a-la-farmacia-y-las-ciencias-i",
      "quimica-general-ii", "bioquimica-general-y-molecular", "morfologia-humana-ii", "matematica-ii", "fisica", "introduccion-a-la-farmacia-y-las-ciencias-ii",
      "quimica-analitica", "quimica-organica-i", "fisiologia-i", "bioestadisticas", "fisicoquimica", "taller-de-iniciacion-farmaceutica", "ingles-i", "ingles-ii"
    ]},

    // Semestre 5
    "analisis-de-medicamentos": { nombre: "Análisis de Medicamentos", prereq: ["analisis-instrumental"] },
    "bioquimica-clinica": { nombre: "Bioquímica Clínica", prereq: ["quimica-organica-ii"] },
    "fisiopatologia-i": { nombre: "Fisiopatología I", prereq: ["fisiologia-ii", "genetica-y-genomica"] },
    "microbiologia-y-bacteriologia": { nombre: "Microbiología y Bacteriología", prereq: ["elementos-inmunes"] },
    "epidemiologia": { nombre: "Epidemiología", prereq: [] },
    "farmacologia-i": { nombre: "Farmacología I", prereq: ["fisiologia-ii", "genetica-y-genomica"] },
    "introduccion-a-la-fe": { nombre: "Introducción a la Fe", prereq: [] },

    // Semestre 6
    "farmacoquimica-i": { nombre: "Farmacoquímica I", prereq: ["bioquimica-clinica"] },
    "farmacognosia": { nombre: "Farmacognosia", prereq: ["farmacologia-i"] },
    "fisiopatologia-ii": { nombre: "Fisiopatología II", prereq: ["fisiopatologia-i"] },
    "microbiologia-y-parasitologia": { nombre: "Microbiología y Parasitología", prereq: ["microbiologia-y-bacteriologia"] },
    "relaciones-interpersonales": { nombre: "Relaciones Interpersonales", prereq: [] },
    "farmacologia-ii": { nombre: "Farmacología II", prereq: ["farmacologia-i"] },
    "etica-cristiana": { nombre: "Ética Cristiana", prereq: [] },

    // Semestre 7
    "farmacoquimica-ii": { nombre: "Farmacoquímica II", prereq: ["farmacoquimica-i"] },
    "toxicologia": { nombre: "Toxicología", prereq: ["farmacologia-ii"] },
    "tecnologia-farmaceutica": { nombre: "Tecnología Farmacéutica", prereq: ["farmacognosia"] },
    "gestion-farmaceutica": { nombre: "Gestión Farmacéutica", prereq: ["relaciones-interpersonales"] },
    "iniciacion-a-la-farmacia-clinica": { nombre: "Iniciación a la Farmacia Clínica", prereq: ["fisiopatologia-ii", "microbiologia-y-parasitologia", "farmacologia-ii"] },
    "certificacion-i": { nombre: "Certificación I", prereq: [] },

    // Semestre 8
    "nutricion-clinica": { nombre: "Nutrición Clínica", prereq: ["iniciacion-a-la-farmacia-clinica"] },
    "electivo-i": { nombre: "Electivo I", prereq: [] },
    "tecnologia-farmaceutica-ii": { nombre: "Tecnología Farmacéutica II", prereq: ["tecnologia-farmaceutica"] },
    "diseno-computacional": { nombre: "Diseño Computacional", prereq: [] },
    "biofarmacia-y-farmacocinetica-clinica": { nombre: "Biofarmacia y Farmacocinética Clínica", prereq: ["iniciacion-a-la-farmacia-clinica"] },
    "farmacia-clinica-i": { nombre: "Farmacia Clínica I", prereq: ["iniciacion-a-la-farmacia-clinica", "toxicologia"] },
    "legislacion-farmaceutica": { nombre: "Legislación Farmacéutica", prereq: [] },

    // Semestre 9
    "electivo-ii": { nombre: "Electivo II", prereq: ["electivo-i"] },
    "farmacia-asistencial": { nombre: "Farmacia Asistencial", prereq: ["nutricion-clinica", "tecnologia-farmaceutica-ii"] },
    "manejo-de-bases-de-datos": { nombre: "Manejo de Bases de Datos", prereq: [] },
    "asuntos-regulatorios": { nombre: "Asuntos Regulatorios", prereq: [] },
    "farmacia-clinica-ii": { nombre: "Farmacia Clínica II", prereq: ["biofarmacia-y-farmacocinetica-clinica", "farmacia-clinica-i"] },
    "certificacion-ii": { nombre: "Certificación II", prereq: [] },

    // Semestre 10
    "electivo-iii": { nombre: "Electivo III", prereq: ["electivo-ii"] },
    "farmacovigilancia-farmacoeconomia": { nombre: "Farmacovigilancia-Farmacoeconomía", prereq: ["farmacia-asistencial"] },
    "farmacia-clinica-iii": { nombre: "Farmacia Clínica III", prereq: ["farmacia-clinica-ii"] },
    "atencion-farmaceutica": { nombre: "Atención Farmacéutica", prereq: ["farmacia-clinica-ii", "farmacia-asistencial"] },
    "metodologia-de-proyectos": { nombre: "Metodología de Proyectos", prereq: [] },
    "certificacion-iii": { nombre: "Certificación III", prereq: [] },

    // Semestre 11
    "practica-profesional": { nombre: "Práctica Profesional", prereq: [
      // requiere todas las actividades hasta semestre 10
      // Simplifico: todas las materias menos practica profesional
      "quimica-general-i", "biologia-celular-y-molecular", "morfologia-humana-i", "matematica-i", "introduccion-a-la-farmacia-y-las-ciencias-i", "aprendizaje-eficiente",
      "quimica-general-ii", "bioquimica-general-y-molecular", "morfologia-humana-ii", "matematica-ii", "fisica", "introduccion-a-la-farmacia-y-las-ciencias-ii", "ingles-i",
      "quimica-analitica", "quimica-organica-i", "fisiologia-i", "bioestadisticas", "fisicoquimica", "taller-de-iniciacion-farmaceutica", "ingles-ii",
      "analisis-instrumental", "quimica-organica-ii", "fisiologia-ii", "elementos-inmunes", "genetica-y-genomica", "taller-de-formacion-farmaceutica",
      "analisis-de-medicamentos", "bioquimica-clinica", "fisiopatologia-i", "microbiologia-y-bacteriologia", "epidemiologia", "farmacologia-i", "introduccion-a-la-fe",
      "farmacoquimica-i", "farmacognosia", "fisiopatologia-ii", "microbiologia-y-parasitologia", "relaciones-interpersonales", "farmacologia-ii", "etica-cristiana",
      "farmacoquimica-ii", "toxicologia", "tecnologia-farmaceutica", "gestion-farmaceutica", "iniciacion-a-la-farmacia-clinica", "certificacion-i",
      "nutricion-clinica", "electivo-i", "tecnologia-farmaceutica-ii", "diseno-computacional", "biofarmacia-y-farmacocinetica-clinica", "farmacia-clinica-i", "legislacion-farmaceutica",
      "electivo-ii", "farmacia-asistencial", "manejo-de-bases-de-datos", "asuntos-regulatorios", "farmacia-clinica-ii", "certificacion-ii",
      "electivo-iii", "farmacovigilancia-farmacoeconomia", "farmacia-clinica-iii", "atencion-farmaceutica", "metodologia-de-proyectos", "certificacion-iii"
    ] }
  };

  // Semestres en orden
  const semestres = [
    ["quimica-general-i","biologia-celular-y-molecular","morfologia-humana-i","matematica-i","introduccion-a-la-farmacia-y-las-ciencias-i","aprendizaje-eficiente"],
    ["quimica-general-ii","bioquimica-general-y-molecular","morfologia-humana-ii","matematica-ii","fisica","introduccion-a-la-farmacia-y-las-ciencias-ii","ingles-i"],
    ["quimica-analitica","quimica-organica-i","fisiologia-i","bioestadisticas","fisicoquimica","taller-de-iniciacion-farmaceutica","ingles-ii"],
    ["analisis-instrumental","quimica-organica-ii","fisiologia-ii","elementos-inmunes","genetica-y-genomica","taller-de-formacion-farmaceutica"],
    ["analisis-de-medicamentos","bioquimica-clinica","fisiopatologia-i","microbiologia-y-bacteriologia","epidemiologia","farmacologia-i","introduccion-a-la-fe"],
    ["farmacoquimica-i","farmacognosia","fisiopatologia-ii","microbiologia-y-parasitologia","relaciones-interpersonales","farmacologia-ii","etica-cristiana"],
    ["farmacoquimica-ii","toxicologia","tecnologia-farmaceutica","gestion-farmaceutica","iniciacion-a-la-farmacia-clinica","certificacion-i"],
    ["nutricion-clinica","electivo-i","tecnologia-farmaceutica-ii","diseno-computacional","biofarmacia-y-farmacocinetica-clinica","farmacia-clinica-i","legislacion-farmaceutica"],
    ["electivo-ii","farmacia-asistencial","manejo-de-bases-de-datos","asuntos-regulatorios","farmacia-clinica-ii","certificacion-ii"],
    ["electivo-iii","farmacovigilancia-farmacoeconomia","farmacia-clinica-iii","atencion-farmaceutica","metodologia-de-proyectos","certificacion-iii"],
    ["practica-profesional"]
  ];

  const mallaEl = document.getElementById("malla");

  // Carga estado aprobado de localStorage
  let aprobado = JSON.parse(localStorage.getItem("malla_aprobado_v1")||"{}");

  // Función que verifica si todos requisitos están aprobados
  function puedeAprobar(materiaId) {
    const prereqs = materiasData[materiaId].prereq;
    return prereqs.every(p => aprobado[p]);
  }

  // Función que devuelve los requisitos no aprobados
  function prereqsFaltantes(materiaId) {
    return materiasData[materiaId].prereq.filter(p => !aprobado[p]);
  }

  // Actualiza la UI, bloquea y desbloquea materias
  function actualizarUI() {
    document.querySelectorAll(".materia").forEach(el => {
      const id = el.dataset.id;
      if (aprobado[id]) {
        el.classList.add("aprobada");
        el.classList.remove("bloqueada");
        el.removeAttribute("data-tooltip");
        el.style.pointerEvents = "auto";
      } else {
        if (puedeAprobar(id)) {
          // Puede desbloquear
          el.classList.remove("bloqueada");
          el.removeAttribute("data-tooltip");
          el.style.pointerEvents = "auto";
        } else {
          // Bloqueada
          el.classList.add("bloqueada");
          // Tooltip con lista de materias faltantes por nombre
          const faltantes = prereqsFaltantes(id).map(x => materiasData[x].nombre).join("\n");
          el.setAttribute("data-tooltip", `Faltan aprobar:\n${faltantes}`);
          el.style.pointerEvents = "none";
          el.classList.remove("aprobada");
        }
      }
    });
  }

  // Crear columnas semestre
  semestres.forEach((listaMaterias, i) => {
    const col = document.createElement("div");
    col.className = "semestre";
    col.innerHTML = `<h2>Semestre ${i+1}</h2>`;
    listaMaterias.forEach(id => {
      const div = document.createElement("div");
      div.className = "materia";
      div.dataset.id = id;
      div.title = materiasData[id].nombre;
      div.textContent = materiasData[id].nombre;
      // Click para toggle aprobado si no bloqueado
      div.addEventListener("click", () => {
        if (div.classList.contains("bloqueada")) return; // no hace nada si bloqueada
        aprobado[id] = !aprobado[id];
        localStorage.setItem("malla_aprobado_v1", JSON.stringify(aprobado));
        actualizarUI();
      });
      col.appendChild(div);
    });
    mallaEl.appendChild(col);
  });

  // Primera actualización UI
  actualizarUI();

})();
</script>

</body>
</html>
